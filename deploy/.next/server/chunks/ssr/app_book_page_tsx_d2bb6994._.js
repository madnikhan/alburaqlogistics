module.exports=[17160,a=>{"use strict";var b,c=a.i(87924),d=a.i(72131),e=a.i(50944),f=a.i(95245),g=a.i(59501),h=a.i(56757),i=a.i(66337),j=a.i(19337),k="clover";"".concat("https://js.stripe.com","/").concat(k,"/stripe.js");var l=function(a,b){a&&a._registerWrapper&&a._registerWrapper({name:"stripe-js",version:"8.5.2",startTime:b})},m=null,n=function(a,b,c){if(null===a)return null;var d,e=b[0].match(/^pk_test/),f=3===(d=a.version)?"v3":d;e&&f!==k&&console.warn("Stripe.js@".concat(f," was loaded on the page, but @stripe/stripe-js@").concat("8.5.2"," expected Stripe.js@").concat(k,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var g=a.apply(void 0,b);return l(g,c),g},o=!1,p=function(){return b?b:b=(null!==m?m:(m=new Promise(function(a,b){a(null)})).catch(function(a){return m=null,Promise.reject(a)})).catch(function(a){return b=null,Promise.reject(a)})};Promise.resolve().then(function(){return p()}).catch(function(a){o||console.warn(a)});var q=a.i(87113);function r({selectedPackage:a,pickupAddress:b,deliveryAddress:e,onPriceCalculated:f}){let[g,h]=(0,d.useState)(null),[i,j]=(0,d.useState)(!1),[k,l]=(0,d.useState)(null);(0,d.useEffect)(()=>{a&&b&&e&&b.length>10&&e.length>10?m():(h(null),l(null))},[a,b,e]);let m=async()=>{if(a){j(!0);try{let c=(await (0,q.calculateDistance)(b,e)).distance,d=a.price,g=(0,q.getPricingBreakdown)(d,c),i=g.totalPrice;h(c),l(i),f&&f({basePrice:d,distance:c,distanceCharge:g.distanceCharge,totalPrice:i})}catch(b){console.error("Error calculating distance:",b),h(0),l(a.price)}finally{j(!1)}}};if(!a)return null;if(i)return(0,c.jsx)("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("svg",{className:"animate-spin h-5 w-5 text-blue-600 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,c.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,c.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,c.jsx)("span",{className:"text-blue-700",children:"Calculating price..."})]})});if(null===g||null===k)return(0,c.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:(0,c.jsx)("p",{className:"text-sm text-gray-600",children:"Enter pickup and delivery addresses to calculate the total price."})});let n=(0,q.getPricingBreakdown)(a.price,g);return(0,c.jsxs)("div",{className:"bg-[#092439]/10 rounded-lg p-4 sm:p-6 mb-6 border border-[#D4AF37]/30",children:[(0,c.jsx)("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-4",children:"Price Breakdown"}),(0,c.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,c.jsxs)("div",{className:"flex justify-between text-sm sm:text-base",children:[(0,c.jsx)("span",{className:"text-gray-600",children:"Base Price:"}),(0,c.jsxs)("span",{className:"font-medium text-gray-900",children:["£",n.basePrice.toFixed(2)]})]}),(0,c.jsxs)("div",{className:"flex justify-between text-sm sm:text-base",children:[(0,c.jsx)("span",{className:"text-gray-600",children:"Distance:"}),(0,c.jsx)("span",{className:"font-medium text-gray-900",children:(0,q.formatDistance)(g)})]}),n.isLocalMove?(0,c.jsx)("div",{className:"bg-green-50 rounded p-2 mt-2",children:(0,c.jsxs)("p",{className:"text-xs sm:text-sm text-green-800",children:["✓ Local move: Distance included in base price (up to ",q.LOCAL_MOVE_THRESHOLD," miles)"]})}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"flex justify-between text-sm sm:text-base mt-2",children:[(0,c.jsxs)("span",{className:"text-gray-600",children:["Included miles (",n.includedMiles," miles):"]}),(0,c.jsx)("span",{className:"font-medium text-gray-900",children:"£0.00"})]}),(0,c.jsxs)("div",{className:"flex justify-between text-sm sm:text-base",children:[(0,c.jsxs)("span",{className:"text-gray-600",children:["Additional miles (",n.chargeableMiles.toFixed(1)," miles × £1.20/mile):"]}),(0,c.jsxs)("span",{className:"font-medium text-gray-900",children:["£",n.distanceCharge.toFixed(2)]})]}),g>100&&(0,c.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Note: Miles over 100 charged at £1.50/mile"})]}),(0,c.jsx)("div",{className:"border-t border-[#D4AF37]/30 pt-2 mt-2",children:(0,c.jsxs)("div",{className:"flex justify-between",children:[(0,c.jsx)("span",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Total Price:"}),(0,c.jsxs)("span",{className:"text-2xl sm:text-3xl font-bold text-[#D4AF37]",children:["£",k.toFixed(2)]})]})})]}),(0,c.jsxs)("div",{className:"text-xs sm:text-sm text-gray-600 bg-white rounded p-2",children:[(0,c.jsxs)("p",{className:"mb-1",children:[(0,c.jsx)("strong",{children:"Pricing:"})," Base price includes up to ",q.LOCAL_MOVE_THRESHOLD," miles.",!n.isLocalMove&&" Additional miles charged at £1.20/mile (50-100 miles) or £1.50/mile (100+ miles)."]}),(0,c.jsxs)("p",{children:["Distance: ",(0,q.formatDistance)(g),process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY?" (calculated)":" (estimated from postcodes)"]})]})]})}let s=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];o=!0;var d=Date.now();return p().then(function(a){return n(a,b,d)})}("your_stripe_publishable_key"),t=h.z.object({customerName:h.z.string().min(2,"Name must be at least 2 characters"),email:h.z.string().email("Invalid email address"),phone:h.z.string().min(10,"Phone number must be at least 10 digits"),serviceType:h.z.enum(["removals","office-moving","house-moving","pallets"]),packageId:h.z.string(),pickupAddress:h.z.string().min(10,"Please provide a complete pickup address"),deliveryAddress:h.z.string().min(10,"Please provide a complete delivery address"),pickupDate:h.z.string().min(1,"Please select a pickup date"),pickupTime:h.z.string().min(1,"Please select a pickup time"),specialInstructions:h.z.string().optional()});function u(){let a=(0,e.useSearchParams)(),[b,h]=(0,d.useState)(null),[k,l]=(0,d.useState)(!1),[m,n]=(0,d.useState)(null),[o,p]=(0,d.useState)(null),{register:u,handleSubmit:v,formState:{errors:w},setValue:x,watch:y}=(0,f.useForm)({resolver:(0,g.zodResolver)(t)}),z=y("serviceType"),A=y("pickupAddress"),B=y("deliveryAddress");(0,d.useEffect)(()=>{let b=a.get("service"),c=a.get("package");b&&x("serviceType",b),c&&(x("packageId",c),h((0,i.getPackageById)(c)||null))},[a,x]);let C=async a=>{if(!b)return void alert("Please select a package");l(!0),n(null);try{let c,d,e=(await (0,q.calculateDistance)(a.pickupAddress,a.deliveryAddress)).distance,f=b.price;if(o)c=o.totalPrice,d=o.distanceCharge;else{let a=(0,q.getPricingBreakdown)(f,e);c=a.totalPrice,d=a.distanceCharge}let g={...a,totalPrice:c,basePrice:f,distance:e,distanceCharge:d,status:"pending",paymentStatus:"pending"},h=await (0,j.createBooking)(g);n(h);try{let c=await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:h,amount:100*(o?.totalPrice||b.price),customerEmail:a.email})});if(!c.ok){let a=await c.json().catch(()=>({error:"Unknown error"}));throw Error(a.error||`Failed to create checkout session (${c.status})`)}let d=await c.json();if(d.error)throw Error(d.error);if(d.id){let a=await s;if(a){let{error:b}=await a.redirectToCheckout({sessionId:d.id});if(b)throw b}else throw Error("Stripe failed to load")}else throw Error("No session ID received")}catch(a){console.log("Stripe not configured, using demo payment:",a.message),window.location.href=`/demo-payment?booking_id=${h}`;return}}catch(a){if(console.error("Error creating booking:",a),m&&confirm("Stripe payment failed. Would you like to use the demo payment system instead?")){window.location.href=`/demo-payment?booking_id=${m}`;return}alert(`There was an error processing your booking: ${a.message||"Please try again."}`),l(!1)}},D=b?[b]:z?(0,i.getPackagesByService)(z):[];return(0,c.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 py-8 sm:py-12 max-w-4xl",children:[(0,c.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-6 sm:mb-8 text-center",children:"Book Your Service"}),m&&(0,c.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:(0,c.jsx)("p",{className:"text-green-800",children:"Booking created successfully! Redirecting to payment..."})}),(0,c.jsxs)("form",{onSubmit:v(C),className:"space-y-6",children:[!b&&z&&(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Package"}),(0,c.jsxs)("select",{...u("packageId"),onChange:a=>{h((0,i.getPackageById)(a.target.value)||null),x("packageId",a.target.value)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent",children:[(0,c.jsx)("option",{value:"",children:"Select a package..."}),D.map(a=>(0,c.jsxs)("option",{value:a.id,children:[a.name," - £",a.price.toFixed(2)]},a.id))]}),w.packageId&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.packageId.message})]}),b&&(0,c.jsxs)("div",{className:"bg-[#092439]/10 rounded-lg p-4 sm:p-6 mb-6 border border-[#D4AF37]/30",children:[(0,c.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-2",children:["Selected Package: ",b.name]}),(0,c.jsx)("p",{className:"text-sm sm:text-base text-gray-700 mb-2",children:b.description}),(0,c.jsxs)("p",{className:"text-xl sm:text-2xl font-bold text-[#D4AF37] mb-2",children:["Base Price: £",b.price.toFixed(2)]}),(0,c.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"Base price includes up to 50 miles. Additional miles charged separately."})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Service Type"}),(0,c.jsxs)("select",{...u("serviceType"),onChange:a=>{x("serviceType",a.target.value),h(null),x("packageId","")},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent",children:[(0,c.jsx)("option",{value:"",children:"Select service type..."}),(0,c.jsx)("option",{value:"removals",children:"Removals"}),(0,c.jsx)("option",{value:"office-moving",children:"Office Moving"}),(0,c.jsx)("option",{value:"house-moving",children:"House Moving"}),(0,c.jsx)("option",{value:"pallets",children:"Pallets"})]}),w.serviceType&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.serviceType.message})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,c.jsx)("input",{...u("customerName"),type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent"}),w.customerName&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.customerName.message})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,c.jsx)("input",{...u("email"),type:"email",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent"}),w.email&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.email.message})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),(0,c.jsx)("input",{...u("phone"),type:"tel",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent"}),w.phone&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.phone.message})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pickup Address *"}),(0,c.jsx)("textarea",{...u("pickupAddress"),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent",placeholder:"Enter full pickup address including postcode"}),w.pickupAddress&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.pickupAddress.message})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Address *"}),(0,c.jsx)("textarea",{...u("deliveryAddress"),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent",placeholder:"Enter full delivery address including postcode"}),w.deliveryAddress&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.deliveryAddress.message})]}),b&&A&&B&&A.length>10&&B.length>10&&(0,c.jsx)(r,{selectedPackage:b,pickupAddress:A,deliveryAddress:B,onPriceCalculated:p}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pickup Date *"}),(0,c.jsx)("input",{...u("pickupDate"),type:"date",min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent"}),w.pickupDate&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.pickupDate.message})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pickup Time *"}),(0,c.jsxs)("select",{...u("pickupTime"),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent",children:[(0,c.jsx)("option",{value:"",children:"Select time..."}),(0,c.jsx)("option",{value:"08:00",children:"8:00 AM"}),(0,c.jsx)("option",{value:"09:00",children:"9:00 AM"}),(0,c.jsx)("option",{value:"10:00",children:"10:00 AM"}),(0,c.jsx)("option",{value:"11:00",children:"11:00 AM"}),(0,c.jsx)("option",{value:"12:00",children:"12:00 PM"}),(0,c.jsx)("option",{value:"13:00",children:"1:00 PM"}),(0,c.jsx)("option",{value:"14:00",children:"2:00 PM"}),(0,c.jsx)("option",{value:"15:00",children:"3:00 PM"}),(0,c.jsx)("option",{value:"16:00",children:"4:00 PM"}),(0,c.jsx)("option",{value:"17:00",children:"5:00 PM"})]}),w.pickupTime&&(0,c.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.pickupTime.message})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions (Optional)"}),(0,c.jsx)("textarea",{...u("specialInstructions"),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent",placeholder:"Any special requirements or instructions..."})]}),(0,c.jsx)("button",{type:"submit",disabled:k||!b,className:"w-full bg-[#092439] text-[#D4AF37] py-4 rounded-lg font-semibold text-lg hover:bg-[#0d3552] transition disabled:bg-gray-400 disabled:cursor-not-allowed",children:k?"Processing...":"Proceed to Payment"})]})]})}function v(){return(0,c.jsx)(d.Suspense,{fallback:(0,c.jsx)("div",{className:"container mx-auto px-4 py-12 text-center",children:"Loading..."}),children:(0,c.jsx)(u,{})})}a.s(["default",()=>v],17160)}];

//# sourceMappingURL=app_book_page_tsx_d2bb6994._.js.map